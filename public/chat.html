<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>brainbase chat</title>
        <link href="https://gtml.gavingogamingrepl.repl.co/regular-ass-style.css" rel="stylesheet" />
        <link href="https://unpkg.com/movement.css/movement.css" rel="stylesheet" />
    </head>
    <body>
        <div class="menu-icon"><i class="fa-solid fa-bars"></i></div>
        <div class="close-icon"><i class="fa-solid fa-x"></i></div>
        <script>
            var menuIcon = document.querySelector(".menu-icon");
            var closeIcon = document.querySelector(".close-icon");
            menuIcon.onclick = () => {
                closeIcon.style.display = "block";
                var nav = document.querySelector(".nav");
                nav.style.display = "block";
                document.querySelector(".content").style.filter = "blur(4px)";
                setTimeout(() => {
                    nav.classList.add("slide-in");
                }, 10);
            };
            closeIcon.onclick = () => {
                closeIcon.style.display = "none";
                var nav = document.querySelector(".nav");
                nav.style.display = "none";
                document.querySelector(".content").style.filter = "none";
                nav.classList.remove("slide-in");
                nav.classList.add("slide-out");
                setTimeout(() => {
                    nav.style.display = "none";
                    document.querySelector(".content").style.filter = "none";
                    nav.classList.remove("slide-out");
                }, 250);
            };
        </script>

        <nav class="nav">
            <ul>
                <li data-link="/"><span>Home</span><i class="fa-solid fa-house"></i></li>
                <li class="spacer">Pages</li>
                <li data-link="/chatbot"><span>Chatbot</span><i class="fa-solid fa-message"></i></li>
                <li data-link="/chatbot/customization"><span>Customization</span><i class="fa-solid fa-gear"></i></li>
                <li data-link="/ask.html"><span>Classic</span><i class="fa-solid fa-microchip"></i></li>
                <li class="spacer">Socials</li>
                <li data-link="https://discord.gg/epBXp5hHBQ"><span>Discord</span><i class="fa-brands fa-discord"></i></li>
            </ul>
        </nav>
        <center class="content">
          <link href='chat.css' rel="stylesheet">
            <h1>Brainbase Chat</h1>
            <ul class="chat">
                <li>
                    <b><i>*Brainbase has joined the chat...*</i></b>
                </li>
            </ul>
            <br />
            <textarea placeholder="Reply..." rows="1" id="question" type="text"></textarea><br />
            <input type="checkbox" id="slang" placeholder="" />Enable slang/act as if you were texting it<br />
            <input type="checkbox" id="innap" checked="true" />Block bad content (ex. swearing)<br />
            <input type="checkbox" id="long" />Allow longer content than two sentences.<br />
            <button class=big onclick="addOn()">Send<i class="fa-duotone fa-paper-plane"></i></button><br />
            <button onclick="saveConvo()"><a>Save <i class="fa-duotone fa-download"></i></a></button>
            <button onclick="loadConvo()"><a>Load <i class="fa-duotone fa-upload"></i></a></button><br />
            <button onclick="window.location.href='/chatbot/customization'"><a>Customization <i class="fa-duotone fa-paintbrush-pencil"></i></a></button><br />
        </center>
        <script>
            let history = [];
            function saveConvo() {
              var Format = `${JSON.stringify(history)}`;
              if(window.localStorage.savedConversations==null||window.localStorage.savedConversations==''||window.localStorage.savedConversations==" "){
                window.localStorage.savedConversations='[]';
              }
              var name = prompt("Name to save the conversation as?");
              var savedCS = JSON.parse(window.localStorage.savedConversations);
              savedCS.push({
                name: name,
                convo: Format
              });
              window.localStorage.savedConversations = JSON.stringify(savedCS);
              alert("Saved!");
            }
            function loadConvo() {
              if(window.localStorage.savedConversations==null||window.localStorage.savedConversations==''||window.localStorage.savedConversations==" "){
                window.localStorage.savedConversations='[]';
              }
              var convos = "";
              for(var CV of JSON.parse(window.localStorage.savedConversations)) {
                convos += "\n"+CV.name;
              }
              var name = prompt("Enter convo name out of these:"+convos, "");
              var comp = false;
              JSON.parse(window.localStorage.savedConversations).forEach(item => {
                if(item.name === name) {
                  history = JSON.parse(item.convo);
                  var chatList = document.querySelector('.chat');
                  var content = `<ul class="chat">`;
                  for(var hI of history) {
                    content +=
                  }
                  alert("Loaded!");
                  comp = true;
                }
              });
              if(!comp) alert("Not found.");
            }
            function handleResponse(jres) {
                if (jres.isError) {
                    document.body.innerHTML = JSON.stringify(jres);
                }
                history.push({
                  answer: jres.answer,
                  person: 'Brainbase'
                });
                for (var l of jres.answer.split(">/>")) {
                    document
                        .querySelector(".chat")
                        .insertAdjacentHTML(
                            "beforeend",
                            `<li><center><div style="text-align:left;"><i class='fa-solid fa-brain-circuit' style='scale:1.3;'></i> <a style='margin-left:10px;'>${l.replaceAll("\\n", "<br>")}</a></div></center></li>`
                        );
                }
            }
            function formatHistory() {
              var historyF = "";
              for(var h of history) {
                historyF += h.person + ": " + h.answer + "\n"
              }
              return historyF;
            }
            function question() {
                var v = document.querySelector("#question").value;
                document.querySelector("#question").value = "";
                return v;
            }
            function addOn() {
                var q = question();
                var slang = document.querySelector("#slang").checked;
                var long = document.querySelector("#long").checked;
                var swear = document.querySelector("#innap").checked;
                if (q == null || q == "" || q == " ") {
                    return;
                }
                document
                    .querySelector(".chat")
                    .insertAdjacentHTML("beforeend", `<li><div style="text-align:left;"><i class='fa-solid fa-user' style='scale:1.3;'></i> <a style='margin-left:16px;'>${q.replaceAll("\n", "<br>")}</a></div></li>`);
                history.push({answer: q, person: 'Human'});
                const params = { history: formatHistory() };
                fetch(
                    "/chatbotresponse" +
                        "?question=" +
                        q +
                        "" +
                        (slang ? "&slang=true" : "&slang=f") +
                        "" +
                        (swear ? "&swear=true" : "&swear=f") +
                        "" +
                        (long ? "&long=true" : "&long=f") +
                        "&person=" +
                        window.localStorage.personality +
                        "&character=" +
                        window.localStorage.character,
                    {
                        method: "POST",
                        body: JSON.stringify(params),
                        headers: {
                            "Content-Type": "application/json",
                        },
                    }
                )
                    .then((res) => res.json())
                    .then((jres) => handleResponse(jres));
            }
            var buttons = document.querySelectorAll(".nav ul li:not(.spacer)");
            buttons.forEach((btn) => {
                btn.addEventListener("click", () => {
                    window.location.href = btn.dataset.link;
                });
            });
        </script>
        <script src="Public.js"></script>
    </body>
</html>
